const map = [

	[1, 0, 0, 0, 0, 0, 0, 2],
	[0, 2, 0, 0, 0, 0, 1, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 2, 0, 0, 0, 0, 1, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 2, 0, 0, 0, 0, 1, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 2, 0, 0, 0, 0, 1, 0],
	[1, 0, 0, 0, 0, 0, 0, 2],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 3, 0, 0, 0, 0, 3, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 2, 0, 0, 0, 0, 2, 0],
	[1, 0, 1, 0, 0, 1, 0, 1],
	[0, 2, 0, 0, 0, 0, 2, 0],
	[1, 0, 1, 0, 0, 1, 0, 1],
	[0, 2, 0, 0, 0, 0, 2, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[1, 0, 1, 0, 0, 1, 0, 1],
	[0, 2, 0, 0, 0, 0, 2, 0],
	[1, 0, 1, 0, 0, 1, 0, 1],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 2, 0, 2, 0, 2, 0],
	[0, 1, 0, 1, 0, 1, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 2, 0, 2, 0, 2, 0],
	[0, 1, 0, 1, 0, 1, 0, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[1, 0, 2, 0, 0, 1, 0, 2],
	[1, 0, 2, 0, 0, 1, 0, 2],
	[1, 0, 2, 0, 0, 1, 0, 2],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 1, 0, 1, 2, 0, 2, 0],
	[0, 0, 3, 0, 0, 1, 0, 0],
	[0, 1, 0, 1, 2, 0, 2, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 1, 0, 0, 0, 0, 1, 0],
	[2, 0, 2, 0, 0, 2, 0, 2],
	[0, 1, 0, 0, 0, 0, 1, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 1, 2, 1, 2, 1, 2, 0],
	[0, 2, 1, 2, 1, 2, 1, 0],
	[0, 1, 2, 1, 2, 1, 2, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[1, 0, 0, 0, 0, 0, 0, 1],
	[2, 0, 0, 1, 1, 0, 0, 2],
	[1, 0, 2, 0, 0, 2, 0, 1],
	[2, 0, 0, 1, 1, 0, 0, 2],
	[1, 0, 3, 0, 0, 3, 0, 1],
	[2, 0, 0, 1, 1, 0, 0, 2],
	[1, 0, 2, 0, 0, 2, 0, 1],
	[2, 0, 0, 1, 1, 0, 0, 2],
	[2, 0, 0, 0, 0, 0, 0, 2],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 0, 0, 0, 1, 0],
	[0, 0, 0, 0, 0, 1, 2, 1],
	[0, 0, 0, 0, 0, 1, 2, 1],
	[0, 0, 0, 0, 0, 0, 1, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 2, 0, 0, 0, 0],
	[0, 0, 0, 0, 2, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 1, 0, 0, 0, 0, 0, 0],
	[1, 2, 1, 0, 0, 0, 0, 0],
	[1, 2, 1, 0, 0, 0, 0, 0],
	[0, 1, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 0, 0, 0, 2, 0],
	[0, 0, 0, 0, 0, 1, 0, 1],
	[0, 0, 0, 0, 0, 0, 2, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 2, 0],
	[0, 0, 0, 0, 0, 1, 0, 1],
	[0, 0, 0, 0, 0, 0, 3, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 2, 0],
	[0, 0, 0, 0, 0, 1, 0, 1],
	[0, 0, 0, 0, 0, 0, 2, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 2, 0, 2, 0, 0, 0, 0],
	[1, 0, 1, 0, 1, 0, 0, 0],
	[0, 2, 0, 2, 0, 0, 0, 0],
	[1, 0, 1, 0, 1, 0, 0, 0],
	[0, 2, 0, 2, 0, 0, 0, 0],
	[1, 0, 1, 0, 1, 0, 0, 0],
	[0, 2, 0, 2, 0, 0, 0, 0],
	[1, 0, 1, 0, 1, 0, 0, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[2, 0, 2, 0, 0, 1, 0, 1],
	[0, 1, 0, 0, 0, 0, 2, 0],
	[2, 0, 2, 0, 0, 1, 0, 1],

	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 2, 0, 0, 0, 0, 1, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],
	[0, 3, 0, 0, 0, 0, 1, 0],
	[1, 0, 1, 0, 0, 2, 0, 2],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 2, 2, 0, 1, 1],
	[0, 0, 0, 2, 2, 0, 1, 1],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 0, 1, 2, 2, 1],
	[0, 0, 0, 0, 2, 1, 1, 2],
	[2, 1, 1, 2, 2, 1, 1, 2],
	[1, 2, 2, 1, 1, 2, 2, 1],
	[1, 2, 2, 1, 0, 0, 0, 0],
	[2, 1, 1, 2, 0, 0, 0, 0],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],

	[0, 0, 0, 0, 0, 1, 2, 1],
	[0, 0, 0, 0, 0, 2, 3, 2],
	[0, 0, 0, 0, 0, 1, 2, 1],

	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0],
	[0, 0, 0, 0, 0, 0, 0, 0]

], enemies = require('./enemies.js')

module.exports = {

	gridWidth: (globals.gameWidth - globals.grid * 2) / map[0].length,

	addRow(){
		const currentRow = map[map.length - 1], thisObj = this;
		for(i = 0; i < currentRow.length; i++){
			switch(currentRow[i]){
				case 1: thisObj.buildBlock(i, '0'); break;
				case 2: thisObj.buildBlock(i, '1'); break;
				case 3: thisObj.buildBlock(i, '2'); break;
			}
		}
		map.splice(map.length - 1, 1)
	},

	buildBlock(index, img){
		const block = PIXI.Sprite.fromImage('img/map/block-' + img + '.png'), size = 40;
		block.anchor.set(.5);
		block.y = -size;
		block.x = globals.gameX + this.gridWidth * index + globals.grid + size / 2;
		block.zOrder = 15;
		block.type = 'mapBlock';
		block.growing = true;
		block.growSeed = Math.floor(Math.random() * 45);
		block.clock = 0;
		block.health = 2;
		if(img != '2') block.rotation = Math.random() * Math.PI;
		if(img == '2') block.power = true;
		globals.game.stage.addChild(block);
	},

	updateMap(){
		if(globals.gameClock % 28 == 0 && map.length) this.addRow();
	},

	updateBlock(block, index){
		block.y += 1.5;
		block.zOrder -= 0.001;
		if(block.clock >= block.growSeed){
			const mod = 0.0025;
			if((block.growing && block.scale.x >= 1.2) || (!block.growing && block.scale.x <= 1)) block.growing = !block.growing;
			const diff = block.growing ? mod : -mod;
			block.scale.set(block.scale.x + diff);
		}
		block.clock++;
		if(block.baseY > globals.gameHeight || block.hit) globals.game.stage.removeChildAt(index);
	},

	update(){
		if(!globals.paused) this.updateMap();
		if(!globals.stageFinished) enemies.currentWave();
	}

};